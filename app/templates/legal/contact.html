{% extends "base.html" %}

{% block title %}Contact & Support - FutureElite{% endblock %}

{% block content %}
<div class="px-4 py-6 sm:px-0 max-w-4xl mx-auto">
    <div class="bg-white shadow rounded-lg p-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Contact & Support</h1>
        <p class="text-sm text-gray-500 mb-8">We're here to help! Get in touch with our support team.</p>

        <div class="prose max-w-none space-y-6">
            <section>
                <h2 class="text-2xl font-semibold text-gray-900 mt-6 mb-4">Support Email</h2>
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                    <p class="text-blue-800 font-semibold">Primary Contact</p>
                    <p class="text-blue-700 mt-2">
                        <strong>Email:</strong> <a href="mailto:{{ support_email }}" class="text-blue-600 hover:underline font-semibold text-lg">{{ support_email }}</a>
                    </p>
                    <p class="text-blue-700 mt-2 text-sm">
                        We typically respond within 24-48 hours during business days.
                    </p>
                </div>
            </section>

            <section>
                <h2 class="text-2xl font-semibold text-gray-900 mt-6 mb-4">Contact Form</h2>
                <form id="contactForm" onsubmit="submitContactForm(event)" class="space-y-4">
                    <div>
                        <label for="contactName" class="block text-sm font-medium text-gray-700 mb-1">Your Name *</label>
                        <input type="text" id="contactName" name="name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-qadsiah-red focus:border-qadsiah-red px-3 py-2">
                    </div>

                    <div>
                        <label for="contactEmail" class="block text-sm font-medium text-gray-700 mb-1">Your Email *</label>
                        <input type="email" id="contactEmail" name="email" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-qadsiah-red focus:border-qadsiah-red px-3 py-2">
                    </div>

                    <div>
                        <label for="contactCategory" class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                        <select id="contactCategory" name="category" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-qadsiah-red focus:border-qadsiah-red px-3 py-2">
                            <option value="">Select a category...</option>
                            <option value="technical">Technical Support</option>
                            <option value="billing">Billing & Subscription</option>
                            <option value="feedback">Feedback & Suggestions</option>
                            <option value="safeguarding">Safeguarding Concern</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div>
                        <label for="contactSubject" class="block text-sm font-medium text-gray-700 mb-1">Subject *</label>
                        <input type="text" id="contactSubject" name="subject" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-qadsiah-red focus:border-qadsiah-red px-3 py-2">
                    </div>

                    <div>
                        <label for="contactMessage" class="block text-sm font-medium text-gray-700 mb-1">Message *</label>
                        <textarea id="contactMessage" name="message" rows="6" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-qadsiah-red focus:border-qadsiah-red px-3 py-2"></textarea>
                    </div>

                    <div class="flex justify-end">
                        <button type="submit" class="bg-qadsiah-red text-white px-6 py-3 rounded-lg font-medium hover:bg-red-700 transition-colors">
                            Send Message
                        </button>
                    </div>
                </form>
            </section>

            <section>
                <h2 class="text-2xl font-semibold text-gray-900 mt-6 mb-4">Support Categories</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-2">Technical Support</h3>
                        <p class="text-sm text-gray-600">
                            Issues with app functionality, bugs, errors, or technical problems.
                        </p>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-2">Billing & Subscription</h3>
                        <p class="text-sm text-gray-600">
                            Questions about subscriptions, payments, cancellations, or refunds.
                        </p>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-2">Feedback & Suggestions</h3>
                        <p class="text-sm text-gray-600">
                            Share your ideas, feature requests, or general feedback.
                        </p>
                    </div>
                    <div class="border border-red-200 rounded-lg p-4 bg-red-50">
                        <h3 class="font-semibold text-red-900 mb-2">Safeguarding Concern</h3>
                        <p class="text-sm text-red-700">
                            Report child safety concerns or inappropriate behavior. Urgent matters will be prioritized.
                        </p>
                    </div>
                </div>
            </section>

            <section>
                <h2 class="text-2xl font-semibold text-gray-900 mt-6 mb-4">Before Contacting Support</h2>
                <p class="text-gray-700 leading-relaxed">
                    Before reaching out, you may find answers in:
                </p>
                <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                    <li><a href="/faq" class="text-qadsiah-red hover:underline">Frequently Asked Questions (FAQ)</a></li>
                    <li><a href="/privacy" class="text-qadsiah-red hover:underline">Privacy Policy</a></li>
                    <li><a href="/terms" class="text-qadsiah-red hover:underline">Terms & Conditions</a></li>
                    <li><a href="/disclaimers" class="text-qadsiah-red hover:underline">Disclaimers</a></li>
                </ul>
            </section>

            <section>
                <h2 class="text-2xl font-semibold text-gray-900 mt-6 mb-4">Response Times</h2>
                <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                    <li><strong>General Inquiries:</strong> 24-48 hours (business days)</li>
                    <li><strong>Technical Support:</strong> 24-48 hours (business days)</li>
                    <li><strong>Billing Questions:</strong> 24-48 hours (business days)</li>
                    <li><strong>Safeguarding Concerns:</strong> Priority handling, typically within 24 hours</li>
                </ul>
            </section>
        </div>

        <div class="mt-8 pt-6 border-t border-gray-200">
            <a href="/" class="text-qadsiah-red hover:underline">‚Üê Back to Home</a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function submitContactForm(event) {
    event.preventDefault();
    
    const form = document.getElementById('contactForm');
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    try {
        showLoading('Sending message...');
        
        // Send to server endpoint
        const result = await apiCall('/api/contact', {
            method: 'POST',
            body: JSON.stringify(data)
        });
        
        if (result.success) {
            hideLoading();
            showToast('Message sent successfully! We will respond within 24-48 hours.', 'success');
            form.reset();
        } else {
            throw new Error(result.errors?.[0] || 'Failed to send message');
        }
    } catch (error) {
        hideLoading();
        console.error('Error sending contact form:', error);
        
        // Fallback to mailto if server fails
        if (error.message.includes('Failed to send') || error.message.includes('SMTP')) {
            const subject = encodeURIComponent(data.category ? `[${data.category.toUpperCase()}] ${data.subject}` : data.subject);
            const body = encodeURIComponent(
                `Name: ${data.name}\n` +
                `Email: ${data.email}\n` +
                `Category: ${data.category}\n\n` +
                `Message:\n${data.message}`
            );
            const mailtoLink = `mailto:{{ support_email }}?subject=${subject}&body=${body}`;
            window.location.href = mailtoLink;
            showToast('Email sending not configured. Opening your email client instead...', 'info');
        } else {
            showToast(error.message, 'error');
        }
    }
}
</script>
{% endblock %}

